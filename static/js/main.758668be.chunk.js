(this["webpackJsonpcyberpunk2077-camera-proto"]=this["webpackJsonpcyberpunk2077-camera-proto"]||[]).push([[0],{34:function(e,t,n){},65:function(e,t,n){},66:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(1),a=n.n(c),o=n(26),i=n.n(o),s=(n(34),n(27)),u=n(2),l=n.n(u),d=n(28),h=n(9),f=n(4),v=n(17),b=n(11),x=(n(65),1080),m={video:{facingMode:{ideal:"environment"},resizeMode:"crop-and-scale",width:{ideal:x}}},g=function(){return[" "].concat(Object(v.a)((e=["1C","55","7A","BD","E9","FF"],Object(v.a)(new Set(e.join("").split("")))))).join("");var e},p=Object(b.createScheduler)(),y=null,j=null,w=function(){if(null!==j)return j;for(var e=[],t=function(t){var n=Object(b.createWorker)({langPath:"/ocr",gzip:!1,logger:function(e){console.log("[worker ".concat(t,"]: "),e),y&&y(e)},errorHandler:function(e){return console.error("[worker ".concat(t,"]: "),e)}}),r=n.load().then((function(){return n.loadLanguage("eng")})).then((function(){return n.initialize("eng")})).then((function(){return n.setParameters({tessedit_char_whitelist:g(),tessedit_pageseg_mode:b.PSM.SINGLE_COLUMN})})).then((function(){p.addWorker(n)}));e.push(r)},n=0;n<1;n++)t(n);return j=Promise.all(e)};function O(e){if("undefined"===typeof e)e="";else if("number"===typeof e)isNaN(e)||"undefined"!==typeof cv&&(e="Exception: "+cv.exceptionFromPtr(e).msg);else if("string"===typeof e){var t=Number(e.split(" ")[0]);isNaN(t)||"undefined"!==typeof cv&&(e="Exception: "+cv.exceptionFromPtr(t).msg)}else e instanceof Error&&(e=e.stack.replace(/\n/g,"<br>"));return e}var M=function(e,t,n,r,c){return(e-t)*(c-r)/(n-t)+r},R=function(e,t,n){var r=e.x,c=e.y;return new cv.Point(M(r,t.xmin,t.xmax,n.xmin,n.xmax),M(c,t.ymin,t.ymax,n.ymin,n.ymax))},k=function(e,t){return Math.hypot(t.x-e.x,t.y-e.y)},C=function(e,t){return{x:t.x-e.x,y:t.y-e.y}},A=function(e,t){return e.x*t.x+e.y*t.y};var S=function(){Object(c.useEffect)((function(){window.feather.replace()}),[]);var e=Object(c.useState)([]),t=Object(f.a)(e,2),n=(t[0],t[1],Object(c.useState)()),a=Object(f.a)(n,2),o=(a[0],a[1],Object(c.useRef)()),i=Object(c.useRef)(),u=Object(c.useRef)(),v=Object(c.useState)("normal"),b=Object(f.a)(v,2),g=b[0],j=b[1],S=Object(c.useRef)(!1);S.current="debug"===g;var N=Object(c.useRef)(),E=Object(c.useRef)(),P=Object(c.useRef)(),_=Object(c.useState)(!1),F=Object(f.a)(_,2),T=F[0],I=F[1],W=function(){var e=Object(h.a)(l.a.mark((function e(){var t,n,r,c,a;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=function(){I(!0)},I(!1),null===(t=navigator)||void 0===t||null===(n=t.mediaDevices)||void 0===n?void 0:n.getUserMedia){e.next=5;break}return alert("Your browser does not support MediaDevices.getUserMedia(). Your browser may be too old. If you're on iOS, only Safari supports the camera API."),e.abrupt("return");case 5:return r=Object(d.a)({},m),o.current.addEventListener("loadedmetadata",c),o.current.setAttribute("autoplay",""),o.current.setAttribute("muted",""),o.current.setAttribute("playsinline",""),e.next=12,window.navigator.mediaDevices.getUserMedia(r);case 12:a=e.sent,o.current.srcObject=a;case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),z=Object(c.useState)(),D=Object(f.a)(z,2),L=D[0],B=D[1],H=Object(c.useRef)([]),G=Object(c.useRef)(),q=Object(c.useCallback)((function(){I(!1),G.current.width=i.current.clientWidth,G.current.height=i.current.clientHeight;var e=G.current.getContext("2d");e.drawImage(i.current,0,0),G.current.classList.remove("d-none");var t=i.current.toDataURL("image/png");B({src:t}),setTimeout(Object(h.a)(l.a.mark((function t(){var n,r,c,a,o,i,u,d,h,f,v,b,x,m,g,j,O,M,R,k,C,A,S;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,console.log("beginning to load tesseract workers"),t.next=4,w();case 4:console.log("finish loading tesseract workers"),n=G.current.height,r=H.current,c=Math.abs(r[1]-r[0]),a=r.map((function(t){return e.getImageData(t,0,c,n)})),o=0,y=function(t){console.log("[worker]: ",t),isNaN(t.progress)||(e.beginPath(),e.fillStyle="#3498db",e.fillRect(o,0,c*t.progress,10),e.closePath())},i=document.createElement("canvas"),u=0;case 13:if(!(u<r.length)){t.next=32;break}return o=r[u],d=a[u],i.width=c,i.height=n,i.getContext("2d").putImageData(d,0,0),h=i.toDataURL("image/png"),t.next=22,p.addJob("recognize",h);case 22:f=t.sent,v=f.data,v.text,b=v.lines,e.textAlign="center",x=Object(s.a)(b);try{for(x.s();!(m=x.n()).done;)g=m.value,j=g.confidence,O=g.text,M=g.bbox,R=M.x0,k=M.y0,C=M.x1,A=M.y1,e.beginPath(),e.strokeStyle="rgba(255, 0, 0, ".concat(255*j,")"),e.lineWidth=2,e.strokeRect(r[u]+R,k,C-R,A-k),S=O.replace(/\s+/g,""),e.font='20px "Rajdhani SemiBold"',e.strokeText(S,r[u]+R+(C-R)/2,A+25),e.closePath()}catch(l){x.e(l)}finally{x.f()}console.log(v);case 29:u++,t.next=13;break;case 32:t.next=38;break;case 34:t.prev=34,t.t0=t.catch(0),console.error(t.t0),alert(t.t0);case 38:case"end":return t.stop()}}),t,null,[[0,34]])}))),100)}),[I,i,B,H]),U=Object(c.useCallback)((function(){I(!1)}),[I]);return Object(c.useEffect)((function(){if(T){var e,t=[0,0,0,0,0,0],n=function(){return t.reduce((function(e,t){return e+t}))/t.length};return Object(h.a)(l.a.mark((function r(){var c,a,s,d,v,b,m,g,p,y,j,w,_,F,T,I,W,z,D,L,B;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(B=function(){return(B=Object(h.a)(l.a.mark((function r(d){var h,v,x,g,E,B,G,q,U,V,Y,J,X,K,Q,Z,$,ee,te,ne,re,ce,ae,oe,ie,se,ue,le,de,he,fe,ve,be,xe,me,ge,pe,ye,je,we,Oe,Me,Re,ke,Ce,Ae,Se,Ne,Ee,Pe,_e,Fe,Te,Ie,We,ze,De,Le,Be,He,Ge;return l.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(void 0!==D){r.next=4;break}D=d,r.next=7;break;case 4:if(!(d-D<33)){r.next=7;break}return e=window.requestAnimationFrame(L),r.abrupt("return");case 7:for(h=1e3/(d-D),t.shift(),t.push(h),P.current.innerText="".concat(Math.round(n())),D=d,r.prev=12,v=function(e,t){return e.reduce((function(e,n){return Math.hypot(t.x-n.x,t.y-n.y)<Math.hypot(t.x-e.x,t.y-e.y)?n:e}))},c.drawImage(o.current,b,m,s,s,0,0,p,y),c.strokeStyle="#00ff00",c.lineWidth=2,c.strokeRect(W,z,T,I),a.drawImage(o.current,b,m,s,s,0,0,N.current.width,N.current.height),x=a.getImageData(_,F,j,w),g=cv.matFromImageData(x),E=new cv.Mat,cv.cvtColor(g,E,cv.COLOR_BGR2GRAY),g.delete(),B=new cv.Mat,cv.GaussianBlur(E,B,new cv.Size(5,5),0,0,cv.BORDER_DEFAULT),E.delete(),G=new cv.Mat,cv.threshold(B,G,185,255,cv.THRESH_BINARY),B.delete(),q=new cv.Mat,U=cv.Mat.ones(4,4,cv.CV_8U),V=new cv.Point(-1,-1),cv.dilate(G,q,U,V,5,cv.BORDER_CONSTANT,cv.morphologyDefaultBorderValue()),U.delete(),Y=new cv.MatVector,J=new cv.Mat,cv.findContours(q,Y,J,cv.RETR_EXTERNAL,cv.CHAIN_APPROX_SIMPLE),X=G.clone(),G.delete(),-2,K=Number.isInteger(Math.sqrt(Y.size()))?Math.sqrt(Y.size()):Math.round(Math.sqrt(Y.size()+-2)-.25),Z=(Q=j/(K-1))*Q,$=function(e){return{x:e.x+e.width/2,y:e.y+e.height/2}},ee=new cv.Mat,cv.cvtColor(q,ee,cv.COLOR_GRAY2RGB),q.delete(),te=[],ne=Y.size(),re=0;re<ne;re++)ce=Y.get(re),ae=cv.contourArea(ce),oe=cv.boundingRect(ce),ie=oe.width/oe.height,ae<=Z&&ie<2.5&&ie>.8?te.push({cnt:ce,boundingRect:oe,midpoint:$(oe)}):ce.delete();if(S.current&&cv.imshow(u.current,ee),ee.delete(),ue=(se=function(e,t){if(0===e.length)return 0;if(1===e.length)return t(e[0]);var n=e.map((function(e){return t(e)}));n.sort((function(e,t){return e-t}));var r=Math.floor(n.length/2);return n.length%2!==0?n[r]:(n[r-1]+n[r])/2})(te,(function(e){return e.boundingRect.height})),le=se(te,(function(e){return e.boundingRect.width})),de=[].concat(te).sort((function(e,t){var n=e.boundingRect,r=t.boundingRect;return Math.hypot(n.height-ue,n.width-le)-Math.hypot(r.height-ue,n.width-le)})).slice(0,K*K),he=de.map((function(e){return e.boundingRect})),te.forEach((function(e){return e.cnt.delete()})),Y.delete(),J.delete(),he.sort((function(e,t){var n=$(e),r=$(t);return n.y,r.y,n.x+1e3*n.y-(r.x+1e3*r.y)})),!(he.length===K*K&&K>=3)){r.next=123;break}if(fe=function(){var e=function(e,t,n){return Math.acos(A(C(e,t),C(t,n))/(k(e,t)*k(t,n)))*(180/Math.PI)},t=e(pe,me,ge),n=e(me,ge,ye),r=e(ge,ye,pe),c=e(ye,pe,me),a=Math.abs(t-pe),o=Math.abs(t-n),i=Math.abs(n-r),s=Math.abs(c-r);if(a>5&&i>5&&o>5&&s>5)return console.log("[rectTooWeird] not an isosceles trapezoid"),!0;if(Math.abs(t-n)>25&&Math.abs(c-r)>25)return console.log("[rectTooWeird] parallellogram"),!0;var u=k(me,ge)/k(pe,ye),l=k(me,pe)/k(ge,ye),d=1/3;if(u>3||u<d||l>3||l<d)return console.log("[rectTooWeird] opposite line ratios"),!0;var h=(k(me,pe)+k(ge,ye))/2;return(k(me,ge)+k(pe,ye))/2/h>3&&(console.log("[rectTooWeird] aspect ratio > 3"),!0)},ve=function(e){var t=e.tl,n=e.tr,r=e.br,c=e.bl,a=Math.hypot(r.x-c.x,r.y-c.y),o=Math.hypot(n.x-t.x,n.y-t.y),i=Math.max(Math.round(o),Math.round(a)),s=Math.hypot(n.x-r.x,n.y-r.y),u=Math.hypot(t.x-c.x,t.y-c.y),l=Math.max(Math.round(s),Math.round(u)),d=Math.min(i,l),h=cv.matFromArray(4,1,cv.CV_32FC2,[t.x,t.y,n.x,n.y,r.x,r.y,c.x,c.y]),f=cv.matFromArray(4,1,cv.CV_32FC2,[0,0,d-1,0,d-1,d-1,0,d-1]),v=cv.getPerspectiveTransform(h,f);return h.delete(),f.delete(),{M:v,newWidth:d,newHeight:d}},be=function(e){for(var t=[],n=0;n<8;n+=2)t.push({x:e.data32F[n],y:e.data32F[n+1]});return t},xe=he.map((function(e){return $(e)})),me=v(xe,{x:0,y:0}),ge=v(xe,{x:j,y:0}),pe=v(xe,{x:0,y:w}),ye=v(xe,{x:j,y:w}),!fe()){r.next=82;break}return console.log("bail-isRectTooWeird"),je=new cv.Mat,cv.resize(X,je,new cv.Size(400,400),cv.INTER_AREA),X.delete(),X=je,cv.cvtColor(X,X,cv.COLOR_GRAY2RGB),cv.imshow(i.current,X),X.delete(),e=window.requestAnimationFrame(L),r.abrupt("return");case 82:if(we=ve({tl:me,tr:ge,br:ye,bl:pe}),Oe=we.M,Me=we.newWidth,Re=we.newHeight,Ce=(ke=Me/(K-1))/2,Ae=ke/2,Se=Oe.inv(cv.DECOMP_SVD),Oe.delete(),Ne=cv.matFromArray(4,1,cv.CV_32FC2,[-Ce,-Ae,Me-1+Ce,0-Ae,Me-1+Ce,Re-1+Ae,0-Ce,Re+1+Ae]),Ee=cv.Mat.zeros(4,1,cv.CV_32FC2),cv.perspectiveTransform(Ne,Ee,Se),Ne.delete(),Se.delete(),Pe=be(Ee),Ee.delete(),_e=ve({tl:Pe[0],tr:Pe[1],br:Pe[2],bl:Pe[3]}),Fe=_e.M,Te=_e.newHeight,Ie=_e.newWidth,We=Ie/Te,!(Te>w+Ae||Ie>j+Ce||We>1.2||We<.8||Pe.some((function(e){return e.x<0-Ce||e.y<0-Ae||e.x>j+Ce||e.y>w+Ae})))){r.next=109;break}return Fe.delete(),console.log("bail-fuckload-of-ehtoja"),ze=new cv.Mat,cv.resize(X,ze,new cv.Size(400,400),cv.INTER_AREA),X.delete(),X=ze,cv.cvtColor(X,X,cv.COLOR_GRAY2RGB),cv.imshow(i.current,X),X.delete(),e=window.requestAnimationFrame(L),r.abrupt("return");case 109:for(De=new cv.Mat,cv.warpPerspective(X,De,Fe,new cv.Size(Te,Ie),cv.INTER_LINEAR,cv.BORDER_CONSTANT,new cv.Scalar),Fe.delete(),X.delete(),X=De,H.current=[],Le=0;Le<K;Le++)Be=M(Le*ke,0,X.cols,0,400),H.current.push(Be);new cv.Scalar(255,255,255),c.beginPath(),c.strokeStyle="#ff0000",c.lineWidth=2,[[Pe[0],Pe[1]],[Pe[1],Pe[2]],[Pe[2],Pe[3]],[Pe[3],Pe[0]]].map((function(e){return e.map((function(e){return R(e,{xmin:0,xmax:j,ymin:0,ymax:w},{xmin:0+W,xmax:T+W,ymin:0+z,ymax:I+z})}))})).forEach((function(e){var t=Object(f.a)(e,2),n=t[0],r=t[1];c.moveTo(n.x,n.y),c.lineTo(r.x,r.y)})),c.stroke(),c.closePath();case 123:He=new cv.Mat,cv.resize(X,He,new cv.Size(400,400),cv.INTER_AREA),X.delete(),X=He,cv.bitwise_not(X,X),cv.cvtColor(X,X,cv.COLOR_GRAY2RGB),cv.imshow(i.current,X),X.delete(),e=window.requestAnimationFrame(L),r.next=140;break;case 134:r.prev=134,r.t0=r.catch(12),Ge=O(r.t0),console.error(Ge),console.error(r.t0),alert(Ge);case 140:case"end":return r.stop()}}),r,null,[[12,134]])})))).apply(this,arguments)},L=function(e){return B.apply(this,arguments)},c=E.current.getContext("2d"),a=N.current.getContext("2d"),s=Math.min(o.current.videoWidth,o.current.videoHeight),d=o.current.videoWidth===s?o.current.videoWidth:o.current.videoHeight,v=o.current.videoHeight===s?o.current.videoHeight:o.current.videoWidth,b=Math.floor((o.current.videoWidth-d)/2),m=Math.floor((o.current.videoHeight-v)/2),N.current.width=x,N.current.height=x,g=x,x,p=E.current.clientWidth,y=p,E.current.width=p,E.current.height=y,u.current.width=p,u.current.height=y,.5,_=540-(j=540)/2,F=540-(w=540)/2,i.current.width=j,i.current.height=w,W=p/2-(T=p/g*j)/2,z=y/2-(I=y/1080*w)/2,!(window.cv instanceof Promise)){r.next=34;break}return r.next=33,window.cv;case 33:window.cv=r.sent;case 34:c.font="16px Input",e=window.requestAnimationFrame(L);case 36:case"end":return r.stop()}}),r)})))(),function(){window.cancelAnimationFrame(e)}}}),[T]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("div",{className:"display-cover",children:[Object(r.jsx)("video",{className:"d-none",autoPlay:!0,ref:o}),Object(r.jsx)("p",{children:"display"}),Object(r.jsx)("div",{style:{display:"flex"},children:["normal","debug"].map((function(e){return Object(r.jsx)("button",{onClick:function(){j(e)},children:e},e)}))}),Object(r.jsx)("canvas",{style:{width:"100%",display:"normal"===g?"block":"none"},ref:E}),Object(r.jsx)("canvas",{style:{width:"100%",display:"debug"===g?"block":"none"},ref:u}),Object(r.jsx)("p",{children:"source"}),Object(r.jsx)("canvas",{className:"d-none",ref:N}),Object(r.jsx)("button",{onClick:U,style:{padding:"0.5rem 2rem"},children:"Stop"}),Object(r.jsx)("button",{onClick:q,style:{padding:"0.5rem 2rem"},children:"Capture"}),Object(r.jsx)("canvas",{className:"d-none",style:{boxSizing:"content-box"},ref:G}),L&&Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("p",{children:["output img as ","<img>"," so you can save it"]}),Object(r.jsx)("img",{src:L.src,style:{border:"1px solid #00ff00"}})]}),Object(r.jsx)("img",{className:"screenshot-image d-none",alt:""}),Object(r.jsxs)("div",{className:"controls",children:[Object(r.jsx)("button",{onClick:W,className:"btn btn-danger play",title:"Play",children:Object(r.jsx)("i",{"data-feather":"play-circle"})}),Object(r.jsx)("button",{className:"btn btn-info pause d-none",title:"Pause",children:Object(r.jsx)("i",{"data-feather":"pause"})}),Object(r.jsx)("button",{className:"btn btn-outline-success screenshot d-none",title:"ScreenShot",children:Object(r.jsx)("i",{"data-feather":"image"})})]})]}),Object(r.jsxs)("p",{children:["output, fps: ",Object(r.jsx)("span",{ref:P})]}),Object(r.jsx)("canvas",{className:"",ref:i})]})},N=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,67)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(S,{})}),document.getElementById("root")),N()}},[[66,1,2]]]);
//# sourceMappingURL=main.758668be.chunk.js.map